# 🌍 World Cities Map - 世界城市地图

一个基于React + TypeScript + react-simple-maps + Ant Design的交互式世界城市地图应用，支持标记访问过的城市、数据持久化、统计分析和智能地名显示。

## ✨ 主要功能

- 🗺️ **交互式世界地图**: 基于react-simple-maps的高质量地图渲染
- 📍 **城市标记**: 支持添加、编辑、删除访问过的城市
- 🎨 **智能地名显示**: 基于130K+真实坐标数据的智能分层显示系统
- 🌍 **国家高亮**: 访问过的国家以绿色高亮显示
- 📊 **数据统计**: 大洲分布、年度时间线、总旅行距离等统计图表
- 💾 **数据持久化**: 使用localStorage保存数据，支持JSON导入导出
- 🌙 **深色模式**: 支持明暗主题切换
- 📱 **响应式设计**: 适配各种屏幕尺寸
- ⚡ **性能优化**: 智能批处理，支持60K+城市数据

## 🚀 快速启动

### **启动脚本选择**

项目提供了3个启动脚本，选择最适合您的：

#### **🥇 启动优化版.bat (推荐)**
- **功能**: 最全面的启动脚本，包含环境检查、自动安装、详细日志
- **适用**: 首次使用、需要详细反馈的用户
- **特点**: 智能错误处理、安装指导、完整的状态反馈

#### **🥈 simple-start.bat (日常使用)**
- **功能**: 简洁快速的启动脚本
- **适用**: 日常开发、快速启动
- **特点**: 轻量级、快速启动、基本错误处理

#### **🥉 start.bat (英文版)**
- **功能**: 英文界面的启动脚本
- **适用**: 国际化用户、英文环境
- **特点**: 英文提示、完整的依赖检查

### **使用方法**

1. **双击启动脚本**: 选择上述任一启动脚本，双击运行
2. **自动环境检查**: 脚本会自动检查Node.js环境
3. **自动依赖安装**: 首次运行会自动安装项目依赖
4. **启动应用**: 应用将在 `http://localhost:3000` 启动
5. **浏览器访问**: 浏览器会自动打开应用页面

### **系统要求**

- **操作系统**: Windows 10/11
- **Node.js**: v16.0.0 或更高版本
- **内存**: 建议4GB以上（处理大量城市数据）
- **网络**: 首次运行需要网络连接下载依赖

## 🎯 核心特性详解

### **基于坐标的智能地名显示系统**

**🚀 革命性改进**: 完全基于130,000+个城市的真实坐标数据，不再依赖缺失的人口或首都标识数据。

**🌍 智能分层显示**:
- **世界级(1.0)**: 用户城市 + 超级城市
- **大陆级(1.2-1.8)**: 知名城市 + 首都 + 5%网格城市
- **区域级(2.0-2.2)**: 用户国家城市 + 10%网格城市
- **国家级(2.6)**: 15%网格城市
- **省级(3.0)**: 20%网格城市
- **城市级(3.5-4.0)**: 20%网格城市
- **街道级(4.5-5.0)**: 15%网格城市

**🎯 地理网格分布算法**:
- 使用2°×2°坐标网格确保全球均匀覆盖
- 基于坐标和城市名称的组合哈希进行智能分布
- 确保每个地理区域都有代表性城市显示

**📊 数据利用率**: 从依赖缺失数据 → 100%利用坐标数据，城市数量从40K → **60K城市**

## 🛠️ 技术栈

- **前端框架**: React 18 + TypeScript
- **地图库**: react-simple-maps
- **UI组件**: Ant Design 5
- **图表库**: Recharts
- **状态管理**: React Hooks
- **数据存储**: localStorage + JSON
- **构建工具**: Create React App
- **样式**: CSS3 + CSS Variables

## 📁 项目结构

```
Travel_map/
├── public/                          # 静态资源
│   ├── world-cities-complete.json  # 130K+城市坐标数据
│   └── index.html                  # HTML入口
├── src/                            # 源代码
│   ├── components/                 # React组件
│   │   ├── WorldMap.tsx           # 核心地图组件
│   │   ├── CityStats.tsx          # 统计图表组件
│   │   ├── CityModal.tsx          # 城市编辑模态框
│   │   ├── Header.tsx             # 应用头部
│   │   └── Sidebar.tsx            # 侧边栏组件
│   ├── utils/                      # 工具函数
│   │   ├── storage.ts             # 数据存储工具
│   │   └── statistics.ts          # 统计计算工具
│   ├── types/                      # TypeScript类型定义
│   ├── styles/                     # 全局样式
│   └── App.tsx                     # 主应用组件
├── 启动优化版.bat                   # 🥇 推荐启动脚本
├── simple-start.bat                # 🥈 快速启动脚本
├── start.bat                       # 🥉 英文启动脚本
├── package.json                    # 项目配置
└── README.md                       # 项目说明
```

## 🔧 开发指南

### **环境设置**

1. **安装Node.js**: 从 [nodejs.org](https://nodejs.org/) 下载安装
2. **克隆项目**: `git clone <repository-url>`
3. **安装依赖**: `npm install`
4. **启动开发**: `npm start`

### **构建生产版本**

```bash
npm run build
```

### **代码质量检查**

```bash
npm run lint
```

## 📊 数据格式

### **城市数据结构**

```typescript
interface City {
  id: string;
  name: string;
  country: string;
  continent?: string;
  coordinates: [number, number]; // [经度, 经度]
  category: 'Visited' | 'Planned' | 'Favorite' | 'Business' | 'Transit';
  visitDate?: string;
  notes?: string;
}
```

### **导入/导出格式**

支持标准JSON格式，包含城市数组和设置对象。

## 🎨 自定义配置

### **主题设置**

- **深色模式**: 自动跟随系统或手动切换
- **标签显示**: 可控制地图标签的显示/隐藏
- **侧边栏**: 可折叠的侧边栏设计

### **地图设置**

- **缩放级别**: 支持1.0-5.0的缩放范围
- **标签密度**: 基于缩放级别的智能标签显示
- **碰撞检测**: 先进的标签重叠检测算法

## 🐛 故障排除

### **常见问题**

1. **端口3000被占用**
   - 解决方案: 关闭其他应用或修改端口
   - 命令: `netstat -ano | findstr :3000`

2. **依赖安装失败**
   - 解决方案: 清除npm缓存
   - 命令: `npm cache clean --force`

3. **地图显示空白**
   - 解决方案: 检查网络连接，确保能访问地图数据源
   - 重启应用或清除浏览器缓存

4. **性能问题**
   - 解决方案: 确保有足够内存（建议4GB+）
   - 关闭其他占用内存的应用

### **获取帮助**

如果遇到问题，请：
1. 检查控制台错误信息
2. 查看网络请求状态
3. 确认Node.js版本兼容性
4. 提交Issue到项目仓库

## 📈 更新日志

详细更新记录请查看 [CHANGELOG.md](./CHANGELOG.md)

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

本项目采用MIT许可证。

---

**🎉 享受您的世界城市地图之旅！** 🌍✨ 